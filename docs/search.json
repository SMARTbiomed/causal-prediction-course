[
  {
    "objectID": "resources.html",
    "href": "resources.html",
    "title": "Resources and references",
    "section": "",
    "text": "References\n\nAmsterdam, Wouter AC van, Nan van Geloven, Jesse H Krijthe, Rajesh Ranganath, and Giovanni Cin√°. 2025. ‚ÄúWhen Accurate Prediction Models Yield Harmful Self-Fulfilling Prophecies.‚Äù Patterns 6 (4).\n\n\nAnkan, Ankur, and Johannes Textor. 2025. ‚ÄúExpert-in-the-Loop Causal Discovery: Iterative Model Refinement Using Expert Knowledge.‚Äù In The 41st Conference on Uncertainty in Artificial Intelligence.\n\n\nBoyer, Christopher B., Issa J. Dahabreh, and Jon A. Steingrimsson. 2024. ‚ÄúEstimating and Evaluating Counterfactual Prediction Models.‚Äù https://arxiv.org/abs/2308.13026.\n\n\nCoston, Amanda, Alan Mishler, Edward H Kennedy, and Alexandra Chouldechova. 2020. ‚ÄúCounterfactual Risk Assessments, Evaluation, and Fairness.‚Äù In Proceedings of the 2020 Conference on Fairness, Accountability, and Transparency, 582‚Äì93.\n\n\nCowley, Laura E, Daniel M Farewell, Sabine Maguire, and Alison M Kemp. 2019. ‚ÄúMethodological Standards for the Development and Evaluation of Clinical Prediction Rules: A Review of the Literature.‚Äù Diagnostic and Prognostic Research 3 (1): 16.\n\n\nDamen, Johanna AAG, Lotty Hooft, Ewoud Schuit, Thomas PA Debray, Gary S Collins, Ioanna Tzoulaki, Camille M Lassale, et al. 2016. ‚ÄúPrediction Models for Cardiovascular Disease Risk in the General Population: Systematic Review.‚Äù British Medical Journal 353.\n\n\nEfthimiou, Orestis, Michael Seo, Konstantina Chalkou, Thomas Debray, Matthias Egger, and Georgia Salanti. 2024. ‚ÄúDeveloping Clinical Prediction Models: A Step-by-Step Guide.‚Äù Bmj 386.\n\n\nGeloven, Nan van, Ruth H Keogh, Wouter van Amsterdam, Giovanni Cin√†, Jesse H Krijthe, Niels Peek, Kim Luijken, et al. 2024. ‚ÄúThe Risks of Risk Assessment: Causal Blind Spots When Using Prediction Models for Treatment Decisions.‚Äù arXiv Preprint arXiv:2402.17366.\n\n\nGeloven, Nan van, Sonja A Swanson, Chava L Ramspek, Kim Luijken, Merel van Diepen, Tim P Morris, Rolf HH Groenwold, Hans C van Houwelingen, Hein Putter, and Saskia le Cessie. 2020. ‚ÄúPrediction Meets Causal Inference: The Role of Treatment in Clinical Prediction Models.‚Äù European Journal of Epidemiology 35: 619‚Äì30.\n\n\nGerds, Thomas A, Tianxi Cai, and Martin Schumacher. 2008. ‚ÄúThe Performance of Risk Prediction Models.‚Äù Biometrical Journal: Journal of Mathematical Methods in Biosciences 50 (4): 457‚Äì79.\n\n\nHippisley-Cox, Julia, Carol Coupland, Yana Vinogradova, John Robson, and P Brindle. 2008. ‚ÄúPerformance of the QRISK Cardiovascular Risk Prediction Algorithm in an Independent UK Sample of Patients from General Practice: A Validation Study.‚Äù Heart 94 (1): 34‚Äì39.\n\n\nKeogh, Ruth H, and Nan Van Geloven. 2024. ‚ÄúPrediction Under Interventions: Evaluation of Counterfactual Performance Using Longitudinal Observational Data.‚Äù Epidemiology 35 (3): 329‚Äì39.\n\n\nKullo, Iftikhar J, Hayan Jouni, Erin E Austin, Sherry-Ann Brown, Teresa M Kruisselbrink, Iyad N Isseh, Raad A Haddad, et al. 2016. ‚ÄúIncorporating a Genetic Risk Score into Coronary Heart Disease Risk Estimates: Effect on Low-Density Lipoprotein Cholesterol Levels (the MI-GENES Clinical Trial).‚Äù Circulation 133 (12): 1181‚Äì88.\n\n\nLin, Lijing, Matthew Sperrin, David A Jenkins, Glen P Martin, and Niels Peek. 2021. ‚ÄúA Scoping Review of Causal Methods Enabling Predictions Under Hypothetical Interventions.‚Äù Diagnostic and Prognostic Research 5: 1‚Äì16.\n\n\nPearl, J. 2009. Causality: Models, Reasoning, and Inference. 2nd ed. New York: Cambridge University Press.\n\n\nPoinsot, Audrey, Panayiotis Panayiotou, Alessandro Leite, Nicolas CHESNEAU, √ñzg√ºr ≈ûim≈üek, and Marc Schoenauer. 2025. ‚ÄúPosition: Causal Machine Learning Requires Rigorous Synthetic Experiments for Broader Adoption.‚Äù In Forty-Second International Conference on Machine Learning Position Paper Track. https://openreview.net/forum?id=Nr2ulBN50q.\n\n\nSachs, Michael C., Arvid Sj√∂lander, and Erin E. Gabriel. 2020. ‚ÄúAim for Clinical Utility, Not Just Predictive Accuracy.‚Äù Epidemiology 31 (3): 359‚Äì64.\n\n\nSilarova, Barbora, Stephen Sharp, Juliet A Usher-Smith, Joanne Lucas, Rupert A Payne, Guy Shefer, Carmel Moore, et al. 2019. ‚ÄúEffect of Communicating Phenotypic and Genetic Risk of Coronary Heart Disease Alongside Web-Based Lifestyle Advice: The INFORM Randomised Controlled Trial.‚Äù Heart 105 (13): 982‚Äì89.\n\n\nWilkinson, Jack, Kellyn F Arnold, Eleanor J Murray, Maarten van Smeden, Kareem Carr, Rachel Sippy, Marc de Kamps, et al. 2020. ‚ÄúTime to Reality Check the Promises of Machine Learning-Powered Precision Medicine.‚Äù The Lancet Digital Health 2 (12): e677‚Äì80."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Home",
    "section": "",
    "text": "Course description\n\n\nCode of conduct\n\n\nCourse materials\n\n\nReferences and resources"
  },
  {
    "objectID": "data/exercises/day3-morning-solutions.html",
    "href": "data/exercises/day3-morning-solutions.html",
    "title": "Causal prediction for medical decision making. Practicals, day 3, morning.",
    "section": "",
    "text": "To use a DAG to decide which variables should be included in an analysis in order to develop a causal prediction model for predicting the risk of CVD death if a person starts statins and if they do not start statins\nTo develop a causal prediction model using g-formula and inverse probability weighting (IPW) approaches for implementation in a test data set in which the same variables are observed as in the training data set\nTo develop a causal prediction model for a situation in which not all variables available in the training data set are available in the deployment data"
  },
  {
    "objectID": "data/exercises/day3-morning-solutions.html#learning-outcomes",
    "href": "data/exercises/day3-morning-solutions.html#learning-outcomes",
    "title": "Causal prediction for medical decision making. Practicals, day 3, morning.",
    "section": "",
    "text": "To use a DAG to decide which variables should be included in an analysis in order to develop a causal prediction model for predicting the risk of CVD death if a person starts statins and if they do not start statins\nTo develop a causal prediction model using g-formula and inverse probability weighting (IPW) approaches for implementation in a test data set in which the same variables are observed as in the training data set\nTo develop a causal prediction model for a situation in which not all variables available in the training data set are available in the deployment data"
  },
  {
    "objectID": "data/exercises/day3-morning-solutions.html#data",
    "href": "data/exercises/day3-morning-solutions.html#data",
    "title": "Causal prediction for medical decision making. Practicals, day 3, morning.",
    "section": "Data",
    "text": "Data\nIn this practical we will continue to use the simulated data on people with type 1 diabetes. Interest lies in obtaining predictions of the 5-year risk of CVD death if a person were to start using statins and if they were not to start using statins. A more detailed specification for the causal prediction model is given in the table below.\n\n\n\n\n\n\n\nEstimand element\nSpecification\n\n\nTarget population\nAdults with type 1 diabetes who have not yet started using statins.\n\n\nTime point of intended use\nAttendance at a screening visit at the diabetes center\n\n\nOutcome and prediction horizon\nCVD death up to 5 years\n\n\nPredictors\nLDL, SBP, motion, polygenic risk score, sex, age, diabetes duration, smoking.\n\n\nTreatment options\n(i) Start using statins\n(ii) Do not start using statins"
  },
  {
    "objectID": "data/exercises/day3-morning-solutions.html#exercises",
    "href": "data/exercises/day3-morning-solutions.html#exercises",
    "title": "Causal prediction for medical decision making. Practicals, day 3, morning.",
    "section": "Exercises",
    "text": "Exercises\n\nUsing the information provided in the table above write down the causal estimands of interest, following the notation used in the lecture slides.\n\nSolution: The estimands of interest are \\(\\Pr(Y^{1}=1| X^*)\\) and \\(\\Pr(Y^{0}=1|X^*)\\) where \\(Y^{1}\\) denotes the counterfactual outcome \\(Y\\) (CVD death within 5 years) under statin treatment, \\(Y^{0}\\) denotes the counterfactual outcome \\(Y\\) under no statin treatment. The predictors \\(X^*\\) are LDL, motion, polygenic risk score, sex, age, diabetes duration, smoking. The estimands could also be written in terms of expectations as \\(E(Y^{1}| X^*)\\) and \\(E(Y^{0}| X^*)\\).\n\nBased on the DAG you used in yesterday‚Äôs practical, we now consider which variables would need to to be included in an analysis in order to develop the causal prediction model, or in other words to enable estimation of \\(\\Pr(Y^{a}=1| X^*)\\) (\\(a=0,1\\)) from the data.\n\nWhat are the \\(L\\) variables and what are the \\(P\\) variables?\nWrite your causal estimand from question 1 in terms of the observed variables, and state your assumptions.\n\n\nSolution: The \\(L\\) variables (confounders of statin use and the outcome) are LDL_0, motion, steno_prs. The \\(P\\) variables (predictors of the outcome but not of statin use) are sex_male, age, diabetes_duration, smoking, SBP_0.\nThe causal estimands can be written as: \\(\\Pr(Y^{1}=1| X^*)=\\Pr(Y^{1}=1|L,P)=\\Pr(Y=1|A=1, L,P)\\) and \\(\\Pr(Y^{0}=1| X^*)=\\Pr(Y^{0}=1|L,P)=\\Pr(Y=1|A=0, L,P)\\). Writing the estimands in terms of the observed data relies on the assumption that \\(X^*=(L,P)\\) are sufficient to control for confounding of the association between statin use and the outcomes, and the consistency assumption.\n\nConsider the prediction model that you developed in the practical on Day 1 (afternoon). Is it suitable for making causal predictions, i.e.¬†for estimating your estimand specified in question 1 above? Discuss why or why not.\n\nSolution: Points to consider are:\n\nWhat was the ‚Äòtime zero‚Äô for your model, and does this align with the time at which you would wish to make the decision about statin use?\nDid your model include all the necessary \\(L\\) variables?\nDid your model include any variables on the causal pathway between statin use and the outcome?\n\n\nRead the training data and the test data into R.\n\nSolution:\n\ntrain &lt;- readRDS(url(\"https://smartbiomed.github.io/causal-prediction-course/data/exercises/data/type1-diabetes-train.rds\"))\n\ntest &lt;- readRDS(url(\"https://smartbiomed.github.io/causal-prediction-course/data/exercises/data/type1-diabetes-test.rds\"))\n\n\nCausal prediction modelling using the g-formula:\n\nUsing the g-formula approach develop a causal-prediction model using the training data that will enable you to estimate the estimand in 1.\nWhat assumptions are you making?\nBased on your model from (b), obtain an estimate of the 5-year risk of CVD death (i) under statin use and (ii) under non-statin use for each individual in the test data. Compare the estimates of risk under the two treatment options.\n\n\nSolution:\n\n\n\nWe fit a logistic regression model including cvd_5year as the outcome \\(Y\\), separately for people with \\(A=1\\) (statin=1)and people with \\(A=0\\) (statin=0). The \\(L\\) variables and \\(P\\) variables (and hence \\(X^*=\\{L,P\\}\\) are as given in Question 2. A different model is discussed below.\n\nmod_A1&lt;-glm(cvd_5year~LDL_0+motion+steno_prs+sex_male+age+diabetes_duration+smoking+SBP_0,data=train[train$statin==1,],family=\"binomial\")\n            \nsummary(mod_A1)\n\n\nCall:\nglm(formula = cvd_5year ~ LDL_0 + motion + steno_prs + sex_male + \n    age + diabetes_duration + smoking + SBP_0, family = \"binomial\", \n    data = train[train$statin == 1, ])\n\nCoefficients:\n                    Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept)        -24.16044    5.46877  -4.418 9.97e-06 ***\nLDL_0                0.48054    0.21240   2.262   0.0237 *  \nmotion              -0.30681    0.86969  -0.353   0.7243    \nsteno_prs           -0.03221    0.24797  -0.130   0.8966    \nsex_male             0.51395    0.52020   0.988   0.3232    \nage                  0.03022    0.06710   0.450   0.6524    \ndiabetes_duration    0.19151    0.07798   2.456   0.0141 *  \nsmoking            -10.81774 1463.09240  -0.007   0.9941    \nSBP_0                0.09547    0.03852   2.478   0.0132 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 199.98  on 253  degrees of freedom\nResidual deviance: 134.47  on 245  degrees of freedom\nAIC: 152.47\n\nNumber of Fisher Scoring iterations: 16\n\nmod_A0&lt;-glm(cvd_5year~LDL_0+motion+steno_prs+sex_male+age+diabetes_duration+smoking+SBP_0,data=train[train$statin==0,],family=\"binomial\")\n            \nsummary(mod_A0)\n\n\nCall:\nglm(formula = cvd_5year ~ LDL_0 + motion + steno_prs + sex_male + \n    age + diabetes_duration + smoking + SBP_0, family = \"binomial\", \n    data = train[train$statin == 0, ])\n\nCoefficients:\n                   Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept)       -25.18343    4.72147  -5.334 9.62e-08 ***\nLDL_0              -0.04390    0.18213  -0.241 0.809527    \nmotion             -0.32112    0.55119  -0.583 0.560169    \nsteno_prs           0.61979    0.21119   2.935 0.003338 ** \nsex_male            0.59437    0.41106   1.446 0.148191    \nage                 0.03546    0.05593   0.634 0.526079    \ndiabetes_duration   0.18992    0.07170   2.649 0.008078 ** \nsmoking             0.54284    1.15971   0.468 0.639724    \nSBP_0               0.12666    0.03315   3.821 0.000133 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 300.29  on 745  degrees of freedom\nResidual deviance: 219.42  on 737  degrees of freedom\nAIC: 237.42\n\nNumber of Fisher Scoring iterations: 7\n\n\n\n\n\n\nWe are assuming that the \\(L\\) variables are sufficient to control for confounding of the association between statins and CVD, i.e.¬†that there are no confounders that are unaccounted for in the model.\nWe are also making modelling assumptions, which include that the continuous \\(L\\) variable (LDL_0) has been entered into the model with the correct functional form. Adding a spline term could be a good idea, for example, though we do not use any splines for the continuous variables here due to the limited sample size.\nIt does not matter whether the \\(P\\) variables are entered in the correct form into the model - using an incorrect form will impact of predictive performance but will not invalidate the models as estimators for the estimand of interest.\nAn alternative would be to fit a combined model in the whole training data including \\(A\\) as a predictor, rather than fitting separate models for \\(A=0,1\\). The alternative model is fitted below. Compared with the separate models, this makes the additional assumption that there are no interactions between treatment use (statin) and any of the \\(X^*\\) variables included in the model.\n\n\nmod&lt;-glm(cvd_5year~statin+LDL_0+motion+steno_prs+sex_male+age+diabetes_duration+smoking+SBP_0,data=train,family=\"binomial\")\n\nsummary(mod)\n\n\nCall:\nglm(formula = cvd_5year ~ statin + LDL_0 + motion + steno_prs + \n    sex_male + age + diabetes_duration + smoking + SBP_0, family = \"binomial\", \n    data = train)\n\nCoefficients:\n                   Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept)       -23.50461    3.45946  -6.794 1.09e-11 ***\nstatin             -0.64374    0.38572  -1.669  0.09514 .  \nLDL_0               0.18286    0.13316   1.373  0.16966    \nmotion             -0.21568    0.43878  -0.492  0.62304    \nsteno_prs           0.37423    0.15519   2.412  0.01589 *  \nsex_male            0.45402    0.31421   1.445  0.14847    \nage                 0.03570    0.04255   0.839  0.40148    \ndiabetes_duration   0.18038    0.05132   3.515  0.00044 ***\nsmoking             0.74341    1.10874   0.670  0.50254    \nSBP_0               0.10969    0.02459   4.461 8.15e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 517.56  on 999  degrees of freedom\nResidual deviance: 364.45  on 990  degrees of freedom\nAIC: 384.45\n\nNumber of Fisher Scoring iterations: 7\n\n\n\n\n\nHere we illustrate obtaining predictions first based on mod_A1 and mod_A0 (i.e.¬†the models fitted separately in the two statin treatment groups) and second using model mod (which included statin as a covariate).\nBased on the model mod, which included statin as a covariate, the estimates of risk under statin use are all lower than the estimates of risk under no statin use. Based on the models mod_A1 and mod_A0, in which the models were fitted separately in the two statin treatment groups, the estimates of risk under statin use tend to be lower than the estimates of risk under no statin use, but there are a few individuals with a higher estimated risk under statin use compared to non-use.\n\n#Obtaining predictions using mod_A1 and mod_A0\npred_A1&lt;-predict(mod_A1,newdata=test,type=\"response\")\npred_A0&lt;-predict(mod_A0,newdata=test,type=\"response\")\n\n#Obtaining predictions using mod\n#First create versions of the test data in which statin is set to 1 for everyone and in which statin is set to 0 for everyone\ntest_A1&lt;-test\ntest_A1$statin&lt;-1\n\ntest_A0&lt;-test\ntest_A0$statin&lt;-0\n\npred_A1b&lt;-predict(mod,newdata=test_A1,type=\"response\")\npred_A0b&lt;-predict(mod,newdata=test_A0,type=\"response\")\n \n#summarise predictions and compare using plots\nsummary(pred_A1)\n\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n0.000000 0.001036 0.004808 0.051115 0.034941 0.936842 \n\nsummary(pred_A0)\n\n     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n9.026e-05 6.699e-03 2.449e-02 8.201e-02 9.011e-02 8.978e-01 \n\nsummary(pred_A1b)\n\n     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n0.0001093 0.0037657 0.0134764 0.0587982 0.0548395 0.8036555 \n\nsummary(pred_A0b)\n\n     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n0.0002081 0.0071440 0.0253447 0.0913213 0.0994628 0.8862540 \n\nplot(pred_A0,pred_A1)\nabline(0,1)\n\n\n\n\n\n\n\nplot(pred_A0b,pred_A1b)\nabline(0,1)\n\n\n\n\n\n\n\n\n\nIn this question we will suppose the risk score variable steno_prs is not going to be available for individuals in the future for whom you will want to obtain predictions under the interventions of statin use or no statin use.\n\nWrite down a new version of the estimand in Q1 to accommodate this information.\nWrite out the steps for using the IPW approach to estimate your new estimand.\nUsing the steps set out in (b) use the training data to develop a causal prediction model targeting your estimand from 6(a).\nObtain estimates of the 5-year risk of CVD death (i) under statin use and (ii) under non-statin use for each individual in the test data. Compare your predictions with those from question 5.\n\n\nSolution:\n\nThe estimands of interest are as before, i.e.¬†\\(\\Pr(Y^{1}=1| X^*)\\) and \\(\\Pr(Y^{0}=1|X^*)\\), except that the predictors \\(X^*\\) are LDL_0, SBP_0, motion, sex_male, age, diabetes duration, smoking. We are now in a situation where one of the \\(L\\) variables (steno_prs) is not in the set of predictors for the causal prediction model, \\(X^*\\). This means that, unlike in question 2, we cannot write \\(\\Pr(Y^{1}=1| X^*)=\\Pr(Y=1|A=1, X^*)\\).\nFirst note that the estimands can be written as \\(\\Pr(Y^{1}=1| X^*)=E\\left\\{\\frac{A}{\\Pr(A=1|L)}Y|X^*\\right\\}\\) and \\(\\Pr(Y^{0}=1| X^*)=E\\left\\{\\frac{(1-A)}{\\Pr(A=0|L)}Y|X^*\\right\\}\\), under assumptions that \\(L\\) is sufficient to control for confounding of the association between \\(A\\) and \\(Y\\), and that we have positivity. The steps for estimating \\(\\Pr(Y^{1}=1| X^*)=E\\left\\{\\frac{A}{\\Pr(A=1|L)}Y|X^*\\right\\}\\) are: (i) Fit a model for \\(\\pi(L)=\\Pr(ùê¥ = 1|ùêø)\\); (ii) Obtain the weights \\(1/\\pi(L)\\); (iii) Fit a weighted logistic regression of \\(Y\\) on \\(X^*\\) in people with \\(A=1\\), where the weights are \\(1/\\pi(L)\\).\n\nThe estimand \\(\\Pr(Y^{0}=1| X^*)=E\\left\\{\\frac{(1-A)}{\\Pr(A=0|L)}Y|X^*\\right\\}\\) can similarly be estimated by obtaining the weights \\(1/(1-\\pi(L))\\), and then fitting a weighted logistic regression of \\(Y\\) on \\(X^*\\) in people with \\(A=0\\), where the weights are \\(1/(1-\\pi(L))\\).\n\n\n\n\n#fit the propensity score model\nmod_ps&lt;-glm(statin~LDL_0+motion+steno_prs,data=train,family=\"binomial\")\n\n#obtain weights\npi_L&lt;-predict(mod_ps,newdata=train,type=\"response\")\ntrain$ipw&lt;-ifelse(train$statin==1,1/pi_L,1/(1-pi_L))\n\n#Fit weighted outcome model in those with A=1\nmod_ipw_A1&lt;-glm(cvd_5year~LDL_0+motion+sex_male+age+diabetes_duration+smoking+SBP_0,data=train[train$statin==1,],family=\"binomial\",weights=ipw)\n\nWarning in eval(family$initialize): non-integer #successes in a binomial glm!\n\n#Fit weighted outcome model in those with A=0\nmod_ipw_A0&lt;-glm(cvd_5year~LDL_0+motion+sex_male+age+diabetes_duration+smoking+SBP_0,data=train[train$statin==0,],family=\"binomial\",weights=ipw)\n\nWarning in eval(family$initialize): non-integer #successes in a binomial glm!\n\n\n\n\n\n\n#Obtain predictions\npred_A1_ipw&lt;-predict(mod_ipw_A1,newdata=test,type=\"response\")\n\npred_A0_ipw&lt;-predict(mod_ipw_A0,newdata=test,type=\"response\")\n\nThe plots below compare the predictions obtained using the IPW analysis, which excludes steno_prs from the set of predictors, and the g-formula analysis. There is a strong positive relationships between predictions under the two prediction models, under both treatment strategies.\n\n#Plot IPW predictions (which exclude steno_prs as a predictor) against g-formula predictions: using g-formula predictions based on 'mod'\nplot(pred_A1,pred_A1_ipw)\nabline(0,1)\n\n\n\n\n\n\n\nplot(pred_A0,pred_A0_ipw)\nabline(0,1)\n\n\n\n\n\n\n\n\n\nWe will now obtain predictions for individuals in the deployment data.\n\nRead in the deployment data.\nUsing your model from question 6, obtain predictions of the 5-year risk of CVD death (i) under statin use and (ii) under non-statin use for each individual.\nSend your predictions from (b) to Mike.\n\n\nSolution:\n\ndeploy &lt;- readRDS(url(\"https://smartbiomed.github.io/causal-prediction-course/data/exercises/data/type1-diabetes-deployment.rds\"))\n\n#Obtain predictions\npred_A1_ipw_deploy&lt;-predict(mod_ipw_A1,newdata=deploy,type=\"response\")\n\npred_A0_ipw_deploy&lt;-predict(mod_ipw_A0,newdata=deploy,type=\"response\")"
  },
  {
    "objectID": "data/exercises/day3-afternoon-solution.html",
    "href": "data/exercises/day3-afternoon-solution.html",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "",
    "text": "Learn how to evaluate the counterfactual performance of a prediction model using inverse probability weighting.\nCompare counterfactual performance of a regular prediction model (developed on day 1) to the counterfactual performance of a causal prediction model you developed in the morning of day 3."
  },
  {
    "objectID": "data/exercises/day3-afternoon-solution.html#aims",
    "href": "data/exercises/day3-afternoon-solution.html#aims",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "",
    "text": "Learn how to evaluate the counterfactual performance of a prediction model using inverse probability weighting.\nCompare counterfactual performance of a regular prediction model (developed on day 1) to the counterfactual performance of a causal prediction model you developed in the morning of day 3."
  },
  {
    "objectID": "data/exercises/day3-afternoon-solution.html#data-preparation",
    "href": "data/exercises/day3-afternoon-solution.html#data-preparation",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "Data preparation",
    "text": "Data preparation\n1 Read the train and test data into R\n\ntrain &lt;- readRDS(url(\"https://smartbiomed.github.io/causal-prediction-course/data/exercises/data/type1-diabetes-train.rds\"))\ntest &lt;- readRDS(url(\"https://smartbiomed.github.io/causal-prediction-course/data/exercises/data/type1-diabetes-test.rds\"))\n\n2a. Fit the (non-causal) steno prediction model you fitted on day 1 to the train set and use it to make predictions on the test set.\n\nsteno_model &lt;- glm(cvd_5year ~ sex_male + age + diabetes_duration + smoking + motion +\n                  HBA1C_0 + urine_albumin_0 + LDL_0 + SBP_0 + eGFR_0,\n                  data = train, family = \"binomial\") \ntest$pred_steno &lt;- predict(steno_model, newdata = test, type = \"response\" )\n\n2b. Also fit the causal prediction model you fitted this morning to the train set using g-computation (where you used two separate outcome models) and use it to make predictions on the test set under the intervention of initiating statins. See morning exercise 5c.\n\nmod_A1 &lt;- glm(cvd_5year~LDL_0 + motion + steno_prs + sex_male + age + diabetes_duration + smoking + SBP_0,  data=train[train$statin==1, ], family = \"binomial\")\n\ntest$pred_A1c &lt;- predict(mod_A1, newdata=test, type=\"response\")\n\n2c. Compare the predictions from both models in a scatterplot. Which one is lowest on average?\n\nplot(test$pred_steno,test$pred_A1c)\nabline(0,1)\n\n\n\n\n\n\n\nmean(test$pred_steno)-mean(test$pred_A1c)\n\n[1] 0.02278099\n\n#scatterplot shows big difference for some patients. On average predictions from the causal model assuming statin initiation are a bit lower than those from steno model."
  },
  {
    "objectID": "data/exercises/day3-afternoon-solution.html#regular-performance-assessment",
    "href": "data/exercises/day3-afternoon-solution.html#regular-performance-assessment",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "Regular performance assessment",
    "text": "Regular performance assessment\n3a. First assess regular performance of both models in the test set by calculating Brier score. Note that on day 1 we used the function riskRegression::Score to calculate Brier score.\n\n#calculate Brier score of steno model and g-comp model trough Score function\ny &lt;- riskRegression::Score(list(\"Steno model\" = steno_model, \"g-comp statins\" = test$pred_A1c),\n                           data = test,\n                           formula = cvd_5year~1,\n                           plots = \"calibration\"\n                          )\ny$Brier\n\n\nResults by model:\n\n            model  Brier  lower  upper\n           &lt;fctr&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;\n1:     Null model  6.150  4.931  7.369\n2:    Steno model  5.397  4.411  6.383\n3: g-comp statins  5.712  4.605  6.820\n\nResults of model comparisons:\n\n            model   reference delta.Brier  lower  upper          p\n           &lt;fctr&gt;      &lt;fctr&gt;      &lt;char&gt; &lt;char&gt; &lt;char&gt;      &lt;num&gt;\n1:    Steno model  Null model      -0.753 -1.398 -0.107 0.02227969\n2: g-comp statins  Null model      -0.438 -1.040  0.165 0.15451046\n3: g-comp statins Steno model       0.315  0.052  0.578 0.01894535\n\n\n3b. Verify that the ‚Äòmanual function‚Äô below gives the same point estimate for Brier score as the Score function.\n\nbrier_steno &lt;- 1/nrow(test) * sum ((test$pred_steno - test$cvd_5year)^2) \n\nbrier_gcomp &lt;- 1/nrow(test) * sum ((test$pred_A1c - test$cvd_5year)^2) \n\nc(brier_steno, brier_gcomp)\n\n[1] 0.05397338 0.05712258\n\n\n3c. Which of the two models appears to perform better on the observed data distribution, judging from the point estimates of Brier score?\n\n# the g-comp model that targets risk with statin initiation performs slightly worse (higher Brier score) than the regular Steno model"
  },
  {
    "objectID": "data/exercises/day3-afternoon-solution.html#counterfactual-performance-assessment",
    "href": "data/exercises/day3-afternoon-solution.html#counterfactual-performance-assessment",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "Counterfactual performance assessment",
    "text": "Counterfactual performance assessment\nNow we continue with counterfactual performance of both models in the test set.\n4a. Assuming that the test data are obtained from the same setting as the train data, what variables are in \\(L\\) and need to be adjusted for when assessing performance?\n\n# Answer: same as before: The $L$ variables (confounders of statin use and the outcome) are LDL_0, motion, steno_prs. (See exercises morning day 3).\n\n4.b Calculate inverse probability weights for use of statins in the test set and make a histogram to assess the distribution of the weights.\n\n#treatment model\nmod_ps &lt;- glm(statin ~ LDL_0 + motion + steno_prs, data=test,family=\"binomial\")\n\n#note that in the lecture I showed the identification formula with exchangeability conditional on full set of covariates $X$. Since we know that the $P^*$ variables do not relate to the treatment process, they can be left out of the weigths model here.\n\n#obtain weights\npi_L &lt;- predict(mod_ps, newdata = test, type = \"response\")\ntest$ipw &lt;- ifelse(test$statin==1, 1/pi_L, 1/(1-pi_L))\n\n#histogram\nhist(test$ipw)\n\n\n\n\n\n\n\n\n5a. Calculate counterfactual Brier score for both candidate models under the scenario where all patients in the test set would initiate statins using inverse probability weighting. You can use a weighted version of the earlier given manual code for the Brier score.\n\nbrier_steno_ipw &lt;- 1/nrow(test) * sum ((test$pred_steno - test$cvd_5year)^2 * (test$statin==1) * test$ipw ) \nbrier_steno_ipw\n\n[1] 0.03261958\n\n# note that the steno model performs somewhat worse according to the counterfactual Brier than according to the regular Brier\n\nbrier_gcomp_ipw &lt;- 1/nrow(test) * sum ((test$pred_A1c - test$cvd_5year)^2 * (test$statin==1) * test$ipw ) \nbrier_gcomp_ipw\n\n[1] 0.03258507\n\n\n5b. Compare results from both models. Which one seems to perform better in a treated scenario?\n\n# The gcomp model accounting for statin initiation has slightly better (i.e. lower) Brier than the steno model now\n\n6. Calculate a calibration curve for the Steno model, once in the regular way and once using weighted observed risks tailored to a scenario with statin initiation. We again provide manual code in the solutions, which you could compare to the Score output from day 1. Note our manual code here uses a loess smoother while Score uses a nearest neighbor smoother by default).\n\nloess_steno_reg &lt;-\n  loess(cvd_5year ~ pred_steno, data = test)\n\nloess_steno_ipw1 &lt;-\n  loess(cvd_5year ~ pred_steno, data=test[test$statin == 1, ], weights = ipw) \n\ncurve_steno_reg &lt;- predict(loess_steno_reg, newdata = test$pred_steno, type = \"response\")\ncurve_steno_ipw &lt;- predict(loess_steno_ipw1,  newdata = test$pred_steno, type = \"response\")\n\n# plot calibration curve\ncal_data_steno &lt;- as.data.frame(cbind(x = test$pred_steno, y_reg = curve_steno_reg, y_ipw = curve_steno_ipw))\n\nlibrary(ggplot2)\np_steno_reg &lt;- \n  ggplot(data = cal_data_steno, aes(x = x, y = y_reg),) + \n  geom_line(linewidth = 1.25) +\n  geom_abline(slope = 1, linetype = \"dashed\") +\n  theme_bw(base_size = 10) +\n  theme(panel.grid = element_blank(), plot.title = element_text(hjust = 0.5)) +\n  scale_y_continuous(breaks = seq(0, 1, 0.25), limits = c(-0.05, 1)) +\n  scale_x_continuous(breaks = seq(0, 1, 0.25), limits = c(-0.05, 1)) +\n  labs(\n    title = \"Steno\",\n    x = \"Predicted risk\",\n    y = \"Observed risk (unweighted)\"\n  )\n\np_steno_ipw &lt;- \n  ggplot(data = cal_data_steno, aes(x = x, y = y_ipw),) + \n  geom_line(linewidth = 1.25) +\n  geom_abline(slope = 1, linetype = \"dashed\") +\n  theme_bw(base_size = 10) +\n  theme(panel.grid = element_blank(), plot.title = element_text(hjust = 0.5)) +\n  scale_y_continuous(breaks = seq(0, 1.00, 0.25), limits = c(-0.05, 1.00)) +\n  scale_x_continuous(breaks = seq(0, 1.00, 0.25), limits = c(-0.05, 1.00)) +\n  labs(\n    title = \"Steno\",\n    x = \"Estimated risk\",\n    y = \"Observed risk (weighted)\"\n  )\n\nlibrary(cowplot)\nplot_grid(p_steno_reg, p_steno_ipw)\n\n\n\n\n\n\n\n\n7. Now calculate a calibration curve for the gcomp model, once in the regular way and once using weighted observed risks, tailored to a scenario with statin initiation.\n\nloess_gcomp_reg &lt;-\n  loess(cvd_5year ~ pred_A1c, data = test)\n\nloess_gcomp_ipw1 &lt;-\n  loess(cvd_5year ~ pred_A1c, data=test[test$statin == 1, ], weights = ipw) \n\ncurve_gcomp_reg &lt;- predict(loess_gcomp_reg, newdata = test$pred_A1c, type = \"response\")\ncurve_gcomp_ipw &lt;- predict(loess_gcomp_ipw1, newdata = test$pred_A1c, type = \"response\")\n\n# plot calibration curve\ncal_data_gcomp &lt;- as.data.frame(cbind(x = test$pred_A1c, y_reg = curve_gcomp_reg, y_ipw = curve_gcomp_ipw))\n\np_gcomp_reg &lt;- \n  ggplot(data = cal_data_gcomp, aes(x = x, y = y_reg),) + \n  geom_line(linewidth = 1.25) +\n  geom_abline(slope = 1, linetype = \"dashed\") +\n  theme_bw(base_size = 10) +\n  theme(panel.grid = element_blank(), plot.title = element_text(hjust = 0.5)) +\n  scale_y_continuous(breaks = seq(0, 1, 0.25), limits = c(-0.05, 1)) +\n  scale_x_continuous(breaks = seq(0, 1, 0.25), limits = c(-0.05, 1)) +\n  labs(\n    title = \"gcomp\",\n    x = \"Estimated risk\",\n    y = \"Observed risk (unweighted)\"\n  )\n\np_gcomp_ipw &lt;- \n  ggplot(data = cal_data_gcomp, aes(x = x, y = y_ipw),) + \n  geom_line(linewidth = 1.25) +\n  geom_abline(slope = 1, linetype = \"dashed\") +\n  theme_bw(base_size = 10) +\n  theme(panel.grid = element_blank(), plot.title = element_text(hjust = 0.5)) +\n  scale_y_continuous(breaks = seq(0, 1.00, 0.25), limits = c(-0.05, 1.00)) +\n  scale_x_continuous(breaks = seq(0, 1.00, 0.25), limits = c(-0.05, 1.00)) +\n  labs(\n    title = \"gcomp\",\n    x = \"Estimated risk\",\n    y = \"Observed risk (weighted)\"\n  )\n\nplot_grid(p_gcomp_reg, p_gcomp_ipw)"
  },
  {
    "objectID": "data/exercises/day2-afternoon.html",
    "href": "data/exercises/day2-afternoon.html",
    "title": "Day 2 afternoon ‚Äòpen and paper‚Äô practical",
    "section": "",
    "text": "Estimands for causal prediction\nPart 1: QRisk\nQRisk is a risk prediction model that provides estimates of the 10-year risk of having a heart attack or stroke. The QRisk tool is available online at https://www.qrisk.org/index.php\n\nUse the online calculator for a person A with the following characteristics (you can leave the other information blank):\n\nPerson A: 45 years old, male, Indian ethnicity, non-smoker, without diabetes. What is this person‚Äôs risk of developing a heart attack or stroke over the next 10 years? Consider another individual, person B, who is similar to person A, except they are on blood pressure treatment.\nPerson B: 45 years old, male, Indian ethnicity, non-smoker, without diabetes, on blood pressure medication.\nWhat is this person‚Äôs predicted risk of developing a heart attack or stroke over the next 10 years, and how does it differ from the risk for person A?\n\nDiscuss some possible reasons for the differences in the risks for person A and person B.\nBased on these findings, discuss whether you would suggest that person B should stop taking their blood pressure treatment.\nSuppose person A has a systolic blood pressure of 150, which is considered high. Would you advise against person A initiating blood pressure medication based on the predictions from this model?\nWhat do you conclude about using this model to inform whether a person should start or stop blood pressure lowering medication?\n\nPart 2: Developing an interventional risk prediction model for blood pressure treatment\nIn this part we will suppose that we would like to develop a model that could help individuals to decide about whether they should consider initiating blood pressure medication in order to lower their risk of having a heart attack or stroke.\n\nDiscuss what you might want such a risk prediction model to do in more detail by considering the elements in the table below. This table is taken from Luijken et al.¬†2024. https://doi.org/10.1002/bimj.70011.\n\n\n\n\n\n\n\n\nEstimand element\nQuestions that help formulate the estimand element\n\n\n\n\nTarget population\n\nTo which individuals will the prediction model be applied?\nIn which health care setting will the prediction model be applied?\n\n\n\nMoment(s) of intended use\n\nAt which moment(s) is the prediction model (re)consulted to inform the intervention decision?\n\n\n\nIntervention options\n\nWhich intervention options are relevant at the moment(s) of making the intervention decision?\nFor how long should the intervention strategy be fixed?\nShould the duration to fix the intervention option be aligned with the time till next moment of prediction?\n\n\n\nOutcome and prediction horizon\n\nWhich outcome(s) are informative for the intervention decision?\nWhat prediction horizon provides important information for the intervention decision: a short-term or long-term horizon?\nShould the outcome be defined differently because of the specified intervention option(s)?\nShould the prediction horizon be aligned with the time till next moment of prediction?\n\n\n\nPredictor(s)\n\nWhich clinical and/or demographic patient factors are predictive of the outcome of interest?\nWhich measurements are available at the moment(s) of intended use?\n\n\n\n\n\nThinking about the causal effect of initiating blood pressure treatment on risk of heart attack or stroke, draw (by hand) a simple causal diagram (a directed acyclic graph ‚Äì DAG) that might be expected to hold in observational data collected. Involve he following variables: sex, smoking status, blood pressure, blood pressure medication use, and having a heart attack or stroke.\n\nIn the population to which the diagram refers, you can assume everyone is aged 45 and of the same ethnicity, to avoid needing to include these variables.\nAre there any other variables that you would add to the diagram?\n\nCan you indicate which variables would need to be adjusted for when targeting the estimand focused on informing initiation of blood pressure medication?\n\nPart 3. Prediction model for successful vaginal delivery\nSeveral models exist that predict a pregnant woman‚Äôs risk of a successful vaginal delivery (versus an emergency c-section), especially in woman who already had a c-section in a previous pregnancy. Here we will look at the MFMU prediction model: Vaginal Birth After Cesarean (MFMU)\nThe model development is described in the paper by Grobman et.al. An annotated version of this paper is available at this link.\n\nRead the relevant parts in the introduction and discussion of the paper (highlighted in yellow in the annotated paper) and determine the treatment decision the model is meant to inform. Which intervention options can patients choose between, and when?\nNow review the relevant parts in the methods section and write down the elements of the estimand targeted by the current model in the second column of the table below.\nAssess the relevance of the current estimand (question 2) to the treatment decision described in question 1.\nFormulate an alternative estimand that would be better aligned to the treatment decision the model aims to inform by writing down adjusted estimand elements in the third column of the table below.\nSuggest changes to the design of the study that would allow us to target the estimand chosen in question 4.\n\n\n\n\nEstimand element\nCurrent estimand targeted by Grobman et al.\nAlternative estimand better aligned to treatment decision\n\n\n\n\nTarget population\n\n\n\n\nMoment(s) of intended use\n\n\n\n\nOutcome and prediction horizon\n\n\n\n\nPredictor(s)\n\n\n\n\nIntervention options"
  },
  {
    "objectID": "data/exercises/day1-morning-with-solution.html",
    "href": "data/exercises/day1-morning-with-solution.html",
    "title": "Day 1 Morning Exercise ‚Äì Solution",
    "section": "",
    "text": "Consider the CVD risk prediction tool for type 1 diabetes (Steno Diabetes Center Copenhagen): https://steno.shinyapps.io/T1RiskEngine/\n\n\n\nWho is eligible to use this calculator?\nAt what occasion can people use this calculator (i.e., what is time zero)?\nIn what direction does the 5-year risk change when you change any of the predictor variables keeping the other predictor variables at a fixed value?\nWhat other risk predictor variables does the Framingham CVD risk calculator use? https://static.heart.org/riskcalc/app/index.html\n\n\n\n\n\nWhat possible applications does this medical risk prediction model have?\nWhich of the risk factors may change over time?\nHow old (relative to time zero) are the measurements of these risk factors allowed to be?\nWhich of the risk factors are modifiable?\nCorrespondingly what would be possible interventions?\nDecision making (for versus against an intervention) could be based on comparing the predicted 5-year risk to a fixed threshold, e.g., 10%. How would one incorporate lower and upper limits for the predicted risks to guide a person‚Äôs decision?\n\nAnswers to the questions:\n\nWho is eligible to use this calculator?\n\nPeople with a type I diabetes diagnosis who are between 18 and 100 years old without a previous CVD event.\n\nAt what occasion can people use this calculator (i.e., what is time zero)?\n\nThis is not explicitly stated but it seems reasonable to assume that time zero is when the date of a measurement of the variables HbA1c, Systolic blood pressure, Albuminuria, eGFR, LDL.\n\nIn what direction does the 5-year risk change when you change any of the predictor variables keeping the other predictor variables at a fixed value?\nAge: Risk increases\nSex: Men have higher risk\nDiabetes duration: Risk increases\nSystolic blood pressure: Risk increases\nAlbuminuria: Risk increases\nLDL: Risk increases\neGFR: Risk decreases\nCurrent smoker: Risk higher\nRegular excercise: Risk lower\nWhat other risk predictor variables does the Framingham CVD risk calculator use? https://static.heart.org/riskcalc/app/index.html\n\nTotal cholesterol, HDL cholesterol, Treatment with Statin, Treatment for Hypertension, Aspirin Therapy\n\n\n\n\nWhat possible applications does this medical risk prediction model have?\n\n\nInform patients\nGuide patients\nSelect patients for RCTs\nRelated research projects\n\n\nWhich of the risk factors may change over time?\n\nHbA1c, LDL, Albuminuria, eGFR, Systolic blood pressure, Regular excercise, Current smoker, Diabetes duration, Age\n\nHow old (relative to time zero) are the measurements of these risk factors allowed to be?\n\nThis is not stated. Intuitively it seems that the measurements need to be recent.\n\nWhich of the risk factors are modifiable?\n\nSystolic blood pressure, albuminuria, eGFR, LDL, smoking, regular exercise\n\nCorrespondingly what would be possible interventions?\n\nStop smoking, start regular exercised, treatment for hypertension, blood sugar control, dietary modification, statins, renal replacement therapy, dialysis.\n\nDecision making (for versus against an intervention) could be based on comparing the predicted 5-year risk to a fixed threshold, e.g., 10%. How would one incorporate lower and upper limits for the predicted risks to guide a person‚Äôs decision?\n\nA conservative strategy would only recommend treatment when the lower limit of the predicted risk is above the threshold, an aggressive strategy would recommend treatment when the upper limit exceeds the threshold."
  },
  {
    "objectID": "data/exercises/day1-morning-with-solution.html#answer-the-following-questions",
    "href": "data/exercises/day1-morning-with-solution.html#answer-the-following-questions",
    "title": "Day 1 Morning Exercise ‚Äì Solution",
    "section": "",
    "text": "Who is eligible to use this calculator?\nAt what occasion can people use this calculator (i.e., what is time zero)?\nIn what direction does the 5-year risk change when you change any of the predictor variables keeping the other predictor variables at a fixed value?\nWhat other risk predictor variables does the Framingham CVD risk calculator use? https://static.heart.org/riskcalc/app/index.html"
  },
  {
    "objectID": "data/exercises/day1-morning-with-solution.html#think-about-and-discuss-the-following-with-your-nearest-neighbors",
    "href": "data/exercises/day1-morning-with-solution.html#think-about-and-discuss-the-following-with-your-nearest-neighbors",
    "title": "Day 1 Morning Exercise ‚Äì Solution",
    "section": "",
    "text": "What possible applications does this medical risk prediction model have?\nWhich of the risk factors may change over time?\nHow old (relative to time zero) are the measurements of these risk factors allowed to be?\nWhich of the risk factors are modifiable?\nCorrespondingly what would be possible interventions?\nDecision making (for versus against an intervention) could be based on comparing the predicted 5-year risk to a fixed threshold, e.g., 10%. How would one incorporate lower and upper limits for the predicted risks to guide a person‚Äôs decision?\n\nAnswers to the questions:\n\nWho is eligible to use this calculator?\n\nPeople with a type I diabetes diagnosis who are between 18 and 100 years old without a previous CVD event.\n\nAt what occasion can people use this calculator (i.e., what is time zero)?\n\nThis is not explicitly stated but it seems reasonable to assume that time zero is when the date of a measurement of the variables HbA1c, Systolic blood pressure, Albuminuria, eGFR, LDL.\n\nIn what direction does the 5-year risk change when you change any of the predictor variables keeping the other predictor variables at a fixed value?\nAge: Risk increases\nSex: Men have higher risk\nDiabetes duration: Risk increases\nSystolic blood pressure: Risk increases\nAlbuminuria: Risk increases\nLDL: Risk increases\neGFR: Risk decreases\nCurrent smoker: Risk higher\nRegular excercise: Risk lower\nWhat other risk predictor variables does the Framingham CVD risk calculator use? https://static.heart.org/riskcalc/app/index.html\n\nTotal cholesterol, HDL cholesterol, Treatment with Statin, Treatment for Hypertension, Aspirin Therapy"
  },
  {
    "objectID": "data/exercises/day1-morning-with-solution.html#think-about-and-discuss-the-following-with-your-nearest-neighbors-1",
    "href": "data/exercises/day1-morning-with-solution.html#think-about-and-discuss-the-following-with-your-nearest-neighbors-1",
    "title": "Day 1 Morning Exercise ‚Äì Solution",
    "section": "",
    "text": "What possible applications does this medical risk prediction model have?\n\n\nInform patients\nGuide patients\nSelect patients for RCTs\nRelated research projects\n\n\nWhich of the risk factors may change over time?\n\nHbA1c, LDL, Albuminuria, eGFR, Systolic blood pressure, Regular excercise, Current smoker, Diabetes duration, Age\n\nHow old (relative to time zero) are the measurements of these risk factors allowed to be?\n\nThis is not stated. Intuitively it seems that the measurements need to be recent.\n\nWhich of the risk factors are modifiable?\n\nSystolic blood pressure, albuminuria, eGFR, LDL, smoking, regular exercise\n\nCorrespondingly what would be possible interventions?\n\nStop smoking, start regular exercised, treatment for hypertension, blood sugar control, dietary modification, statins, renal replacement therapy, dialysis.\n\nDecision making (for versus against an intervention) could be based on comparing the predicted 5-year risk to a fixed threshold, e.g., 10%. How would one incorporate lower and upper limits for the predicted risks to guide a person‚Äôs decision?\n\nA conservative strategy would only recommend treatment when the lower limit of the predicted risk is above the threshold, an aggressive strategy would recommend treatment when the upper limit exceeds the threshold."
  },
  {
    "objectID": "conduct.html",
    "href": "conduct.html",
    "title": "Code of Conduct",
    "section": "",
    "text": "We are committed to providing a safe, inclusive, welcoming, and harassment-free experience for everyone.\nWe try to cultivate a community with shared values, where people are comfortable exploring ideas, asking questions, and saying things like ‚ÄúI don‚Äôt understand‚Äù or ‚ÄúWhy‚Äù. Assume competence in the people you interact with. There are no stupid questions.\nBe considerate in speech and actions, and actively seek to acknowledge and respect the boundaries of people who participate in our activities.\nTake care of each other. Alert Michael Sachs if you notice a dangerous situation, someone in distress, or a potential violation of this Code of Conduct, even if it seems inconsequential. If Michael is the subject of the Alert or has a conflict of interest, please inform Naomi Wray, the director of the Pioneer centre.\n\nExpected Behavior\nAll participants are expected to behave in accordance with professional standards, with both this Code of Conduct as well as their respective employer‚Äôs policies governing appropriate workplace behavior, and all applicable laws.\nWe‚Äôre committed to providing welcome environments where people behave according to professional standards. We expect everyone to contribute to a welcoming, civil, safe, and tolerant environment.\nExamples of encouraged behavior that contributes to a positive environment include:\n\nUsing welcoming and inclusive language\nBeing respectful of differing viewpoints and experiences\nGracefully accepting constructive criticism\nFocusing on what is best for everyone in the group\nShowing empathy towards other participants\n\n\n\nUnacceptable Behavior\nWe do not tolerate harassment in any form. Adherence to our Code of Conduct requires refraining from demeaning, discriminatory, or harassing behavior and speech including, but not limited to:\n\noffensive comments related to gender, gender identity and expression, age, sexual orientation, disability, physical appearance, body size, race, ethnicity, religion (or lack thereof), nationality, native language, or technology choices\nunwelcome comments regarding a person‚Äôs lifestyle choices and practices, including those related to food, health, parenting, drugs, or career stage\nsustained or willful disruption of discussions, talks, or other events, including online discussion.\ndeliberate intimidation\ncontinued one-on-one communication after requests to cease\nunwanted photography or recording, including logging online activity for harassment purposes\npattern of inappropriate social contact, such as requesting/assuming inappropriate levels of intimacy with others\ninappropriate physical contact without consent or after a request to stop. In virtual settings, inappropriate simulated physical contact used without consent, such as textual descriptions like ‚Äúhug‚Äù or ‚Äúbackrub‚Äù or emojis representing such contacts.\nstalking or following behavior, including in virtual settings, such as persistent unwanted direct messages, sending unwanted pictures or malware links, or logging online activity for harassment purposes.\nthreats of violence or incitement of violence towards any individual, including encouraging a person to commit suicide or to engage in self-harm\nuse of sexual or discriminatory imagery, comments, or jokes\nunwelcome sexual attention, which can include inappropriate questions of a sexual nature, asking for sexual favors, or repeatedly asking for dates or contact information.\ndeliberate ‚Äúouting‚Äù of any aspect of a person‚Äôs identity without their consent except as necessary to protect vulnerable people from intentional abuse\ndeliberate misgendering or use of ‚Äúdead‚Äù or rejected names\nnon-consensual publication of non-harassing private communication, including screenshots of private discussion channels or direct messages.\n\n\n\nConsequences of Code of Conduct Violations\nParticipants who are asked to stop any inappropriate behavior are expected to comply immediately. This applies to any events and platforms, either online or in-person. If a participant engages in behavior that violates this code of conduct, the leadership may warn the offender, ask them to leave the group or meeting, or engage higher-level leadership and/or law enforcement to investigate the Code of Conduct violation and impose appropriate sanctions.\nPotential responses include:\n\nban from the meetings and virtual spaces in order to stop the inappropriate behavior;\na formal warning to stop the harassing behavior;\nexpulsion from the group;\ncancellation or early termination of employment or other contributions to the group.\n\n\n\nReporting Guidelines\nIf you experience or witness unacceptable behavior, or have any other concerns, please submit a report to Michael Sachs or one of the other teachers as soon as possible either by email or by contacting him directly. If Michael has a conflict of interest with a report either directly or via a close personal relationship, an alternative point of contact is Naomi Wray, the director of the centre. In that case, Michael will be recused and will not have access to the content or process of the report followup.\nIf you are planning to attend an upcoming event or join an online channel, and have concerns regarding another individual who may be present, please submit a report as described above. We will work with you to take precautions to ensure your comfort and safety. These precautions may include: providing an escort, preparing onsite event staff, and/or providing on-site contact cell phone numbers for immediate contact. In some cases, we may take action to prevent a harasser from participating in the event.\n\n\nCredits\nThis Code of Conduct has been influenced by and adapted from the rOpenSci Code of Conduct (https://ropensci.org/code-of-conduct/)."
  },
  {
    "objectID": "data/exercises/day1-afternoon.html",
    "href": "data/exercises/day1-afternoon.html",
    "title": "Practical day 1 afternoon",
    "section": "",
    "text": "Read about the data, read it into R, and examine the data and benchmark models\nMake your own prediction model using the training dataset\nProvide an estimate of some metric to quantify how well your model performs using test data or cross validation\nPredict the probability of the outcome in the validation set and send the predictions to the teachers."
  },
  {
    "objectID": "data/exercises/day1-afternoon.html#links-to-datasets",
    "href": "data/exercises/day1-afternoon.html#links-to-datasets",
    "title": "Practical day 1 afternoon",
    "section": "Links to datasets",
    "text": "Links to datasets\n\nTraining set: For developing your risk prediction model.\nTest set: For evaluating your risk prediction model.\nDeployment set: For predicting unknown outcome and sending to the honest broker for testing."
  },
  {
    "objectID": "data/exercises/day1-morning.html",
    "href": "data/exercises/day1-morning.html",
    "title": "Day 1 Morning Exercise",
    "section": "",
    "text": "Consider the CVD risk prediction tool for type 1 diabetes (Steno Diabetes Center Copenhagen): https://steno.shinyapps.io/T1RiskEngine/ \n\nAnswer the following questions:\n\nWho is eligible to use this calculator?\nAt what occasion can people use this calculator (i.e., what is time zero)?\nIn what direction does the 5-year risk change when you change any of the predictor variables keeping the other predictor variables at a fixed value?\nWhat other risk predictor variables does the Framingham CVD risk calculator use? https://static.heart.org/riskcalc/app/index.html\n\n\n\nThink about and discuss the following with your nearest neighbors:\n\nWhat possible applications does this medical risk prediction model have?\nWhich of the risk factors may change over time?\nHow old (relative to time zero) are the measurements of these risk factors allowed to be?\nWhich of the risk factors are modifiable?\nCorrespondingly what would be possible interventions?\nDecision making (for versus against an intervention) could be based on comparing the predicted 5-year risk to a fixed threshold, e.g., 10%. How would one incorporate lower and upper limits for the predicted risks to guide a person‚Äôs decision?"
  },
  {
    "objectID": "data/exercises/day2-morning.html",
    "href": "data/exercises/day2-morning.html",
    "title": "Day 2 Morning Exercise",
    "section": "",
    "text": "Causal DAGs\n\nDraw a causal DAG for the example data you used yesterday for the predictions.\nDo you think this is a causal DAG? Meaning are all common causes represented, or can you think of common causes that are not in your current figure? Do you have any arrows you are unsure of the direction?\nDo you have any colliders in your DAG?\nConsider the variable statin as the exposure and the outcome of cvd_5year. Please write down your estimand of interest using counterfactuals.\nGiven the DAG, are the assumptions needed to identify your estimand fulfilled?\nIf so, how would you estimate your estimand, if not, what is the problem?"
  },
  {
    "objectID": "data/exercises/day3-afternoon.html",
    "href": "data/exercises/day3-afternoon.html",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "",
    "text": "Learn how to evaluate the counterfactual performance of a prediction model using inverse probability weighting.\nCompare counterfactual performance of a regular prediction model (developed on day 1) to the counterfactual performance of a causal prediction model you developed in the morning of day 3."
  },
  {
    "objectID": "data/exercises/day3-afternoon.html#aims",
    "href": "data/exercises/day3-afternoon.html#aims",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "",
    "text": "Learn how to evaluate the counterfactual performance of a prediction model using inverse probability weighting.\nCompare counterfactual performance of a regular prediction model (developed on day 1) to the counterfactual performance of a causal prediction model you developed in the morning of day 3."
  },
  {
    "objectID": "data/exercises/day3-afternoon.html#data-preparation",
    "href": "data/exercises/day3-afternoon.html#data-preparation",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "Data preparation",
    "text": "Data preparation\n1 Read the train and test data into R\n2a. Fit the (non-causal) steno prediction model you fitted on day 1 to the train set and use it to make predictions on the test set.\n2b. Also fit the causal prediction model you fitted this morning to the train set using g-computation (where you used two separate outcome models) and use it to make predictions on the test set under the intervention of initiating statins. See morning exercise 5c.\n2c. Compare the predictions from both models in a scatterplot. Which one is lowest on average?"
  },
  {
    "objectID": "data/exercises/day3-afternoon.html#regular-performance-assessment",
    "href": "data/exercises/day3-afternoon.html#regular-performance-assessment",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "Regular performance assessment",
    "text": "Regular performance assessment\n3a. First assess regular performance of both models in the test set by calculating Brier score. Note that on day 1 we used the function riskRegression::Score to calculate Brier score.\n3b. Verify that the ‚Äòmanual function‚Äô below gives the same point estimate for Brier score as the Score function.\n\nbrier_steno &lt;- 1/nrow(test) * sum ((test$pred_steno - test$cvd_5year)^2) \n\nbrier_gcomp &lt;- 1/nrow(test) * sum ((test$pred_A1c - test$cvd_5year)^2) \n\nc(brier_steno, brier_gcomp)\n\n3c. Which of the two models appears to perform better on the observed data distribution, judging from the point estimates of Brier score?"
  },
  {
    "objectID": "data/exercises/day3-afternoon.html#counterfactual-performance-assessment",
    "href": "data/exercises/day3-afternoon.html#counterfactual-performance-assessment",
    "title": "Practical day 3 afternoon: evaluation of causal prediction models",
    "section": "Counterfactual performance assessment",
    "text": "Counterfactual performance assessment\nNow we continue with counterfactual performance of both models in the test set.\n4a. Assuming that the test data are obtained from the same setting as the train data, what variables are in \\(L\\) and need to be adjusted for when assessing performance?\n4.b Calculate inverse probability weights for use of statins in the test set and make a histogram to assess the distribution of the weights.\n5a. Calculate counterfactual Brier score for both candidate models under the scenario where all patients in the test set would initiate statins using inverse probability weighting. You can use a weighted version of the earlier given manual code for the Brier score.\n5b. Compare results from both models. Which one seems to perform better in a treated scenario?\n6. Calculate a calibration curve for the Steno model, once in the regular way and once using weighted observed risks tailored to a scenario with statin initiation. We again provide manual code in the solutions, which you could compare to the Score output from day 1. Note our manual code here uses a loess smoother while Score uses a nearest neighbor smoother by default).\n7. Now calculate a calibration curve for the gcomp model, once in the regular way and once using weighted observed risks, tailored to a scenario with statin initiation."
  },
  {
    "objectID": "data/exercises/day3-morning.html",
    "href": "data/exercises/day3-morning.html",
    "title": "Causal prediction for medical decision making. Practicals, day 3, morning.",
    "section": "",
    "text": "To use a DAG to decide which variables should be included in an analysis in order to develop a causal prediction model for predicting the risk of CVD death if a person starts statins and if they do not start statins\nTo develop a causal prediction model using g-formula and inverse probability weighting (IPW) approaches for implementation in a test data set in which the same variables are observed as in the training data set\nTo develop a causal prediction model for a situation in which not all variables available in the training data set are available in the deployment data"
  },
  {
    "objectID": "data/exercises/day3-morning.html#learning-outcomes",
    "href": "data/exercises/day3-morning.html#learning-outcomes",
    "title": "Causal prediction for medical decision making. Practicals, day 3, morning.",
    "section": "",
    "text": "To use a DAG to decide which variables should be included in an analysis in order to develop a causal prediction model for predicting the risk of CVD death if a person starts statins and if they do not start statins\nTo develop a causal prediction model using g-formula and inverse probability weighting (IPW) approaches for implementation in a test data set in which the same variables are observed as in the training data set\nTo develop a causal prediction model for a situation in which not all variables available in the training data set are available in the deployment data"
  },
  {
    "objectID": "data/exercises/day3-morning.html#data",
    "href": "data/exercises/day3-morning.html#data",
    "title": "Causal prediction for medical decision making. Practicals, day 3, morning.",
    "section": "Data",
    "text": "Data\nIn this practical we will continue to use the simulated data on people with type 1 diabetes. Interest lies in obtaining predictions of the 5-year risk of CVD death if a person were to start using statins and if they were not to start using statins. A more detailed specification for the causal prediction model is given in the table below.\n\n\n\n\n\n\n\nEstimand element\nSpecification\n\n\nTarget population\nAdults with type 1 diabetes who have not yet started using statins.\n\n\nTime point of intended use\nAttendance at a screening visit at the diabetes center\n\n\nOutcome and prediction horizon\nCVD death up to 5 years\n\n\nPredictors\nLDL, SBP, motion, polygenic risk score, sex, age, diabetes duration, smoking.\n\n\nTreatment options\n(i) Start using statins\n(ii) Do not start using statins"
  },
  {
    "objectID": "data/exercises/day3-morning.html#exercises",
    "href": "data/exercises/day3-morning.html#exercises",
    "title": "Causal prediction for medical decision making. Practicals, day 3, morning.",
    "section": "Exercises",
    "text": "Exercises\n\nUsing the information provided in the table above write down the causal estimands of interest, following the notation used in the lecture slides.\n\n\nBased on the DAG you used in yesterday‚Äôs practical, we now consider which variables would need to to be included in an analysis in order to develop the causal prediction model, or in other words to enable estimation of \\(\\Pr(Y^{a}=1| X^*)\\) (\\(a=0,1\\)) from the data.\n\nWhat are the \\(L\\) variables and what are the \\(P\\) variables?\nWrite your causal estimand from question 1 in terms of the observed variables, and state your assumptions.\n\n\n\nConsider the prediction model that you developed in the practical on Day 1 (afternoon). Is it suitable for making causal predictions, i.e.¬†for estimating your estimand specified in question 1 above? Discuss why or why not.\n\n\nRead the training data and the test data into R.\n\n\nCausal prediction modelling using the g-formula:\n\nUsing the g-formula approach develop a causal-prediction model using the training data that will enable you to estimate the estimand in 1.\nWhat assumptions are you making?\nBased on your model from (b), obtain an estimate of the 5-year risk of CVD death (i) under statin use and (ii) under non-statin use for each individual in the test data. Compare the estimates of risk under the two treatment options.\n\n\n\nIn this question we will suppose the risk score variable steno_prs is not going to be available for individuals in the future for whom you will want to obtain predictions under the interventions of statin use or no statin use.\n\nWrite down a new version of the estimand in Q1 to accommodate this information.\nWrite out the steps for using the IPW approach to estimate your new estimand.\nUsing the steps set out in (b) use the training data to develop a causal prediction model targeting your estimand from 6(a).\nObtain estimates of the 5-year risk of CVD death (i) under statin use and (ii) under non-statin use for each individual in the test data. Compare your predictions with those from question 5.\n\n\n\nWe will now obtain predictions for individuals in the deployment data.\n\nRead in the deployment data.\nUsing your model from question 6, obtain predictions of the 5-year risk of CVD death (i) under statin use and (ii) under non-statin use for each individual.\nSend your predictions from (b) to Mike."
  },
  {
    "objectID": "description.html",
    "href": "description.html",
    "title": "Course description",
    "section": "",
    "text": "The development of risk prediction algorithms has exploded in recent years in the medical research literature, yet few of these make their way into routine clinical practice. A primary purpose of prediction models is often stated as being to inform clinical decision making, such as whether to give a treatment to a particular patient. However, it has been shown that prediction models are typically not designed in a way that makes them a valid tool for informing such decisions, in particular because they do not appropriately accommodate the treatment decision at their design stage. Similarly, the evaluation of prediction models does not focus on how well the model would perform for the task of informing clinical decision making. A useful model should be evaluated from the perspective of its intended use and the intended users. Evaluation should consider not only predictive performance, but should also be based on costs and benefits which are defined by the clinical context and the available resources."
  },
  {
    "objectID": "description.html#day-1",
    "href": "description.html#day-1",
    "title": "Course description",
    "section": "Day 1",
    "text": "Day 1\n\nOverview and introduction to risk prediction modeling. Lectures and practical.\nPrediction modeling issues and methods. Lectures and group exercises.\nValidation methods, missing data, time-to-event outcomes, motivating examples.\nIntroduction to causal prediction. Lecture."
  },
  {
    "objectID": "description.html#day-2",
    "href": "description.html#day-2",
    "title": "Course description",
    "section": "Day 2",
    "text": "Day 2\n\nIntroduction to causal inference. Lectures, practical, group exercises.\nCausal graphs, estimands, estimation methods.\nFormalization of causal prediction. Lectures and group exercises.\nWhen non-causal prediction methods fail, causal prediction estimands."
  },
  {
    "objectID": "description.html#day-3",
    "href": "description.html#day-3",
    "title": "Course description",
    "section": "Day 3",
    "text": "Day 3\n\nEstimation of causal prediction models. Lectures and practical.\nAssumptions, adjustment sets and confounding, weighting and standardisation methods, doubly-robust methods.\nEvaluation of causal prediction models. Lectures and practical.\nPerformance metrics and their estimation."
  },
  {
    "objectID": "description.html#day-4",
    "href": "description.html#day-4",
    "title": "Course description",
    "section": "Day 4",
    "text": "Day 4\n\nAdvanced topics. Lectures.\nTime to event outcomes and competing events, time varying treatments and confounding.\nCase studies. Group discussion.\nCase studies continued. Group discussion.\nAdvanced topics continued: clinical utility. Lecture.\nSummary and review. With Q&A."
  },
  {
    "objectID": "materials.html",
    "href": "materials.html",
    "title": "Course materials",
    "section": "",
    "text": "Coming soon!"
  },
  {
    "objectID": "materials.html#morning",
    "href": "materials.html#morning",
    "title": "Course materials",
    "section": "Morning",
    "text": "Morning\n\nLecture 1: Prediction models in medicine, Michael Sachs (pdf)\nLecture 2: Medical risk prediction models, Thomas Gerds (pdf)\nExercise 1: The Steno Risk engine\n\nSolutions"
  },
  {
    "objectID": "materials.html#afternoon",
    "href": "materials.html#afternoon",
    "title": "Course materials",
    "section": "Afternoon",
    "text": "Afternoon\n\nLecture 3: Obstacles and pitfalls, Thomas Gerds (pdf)\nLecture 4: Learning algorithms and validation, Michael Sachs (pdf)\nExercise 2: Developing and validating your own models\nLecture 5: Introduction to causal prediction, Ruth Keogh (pdf)"
  },
  {
    "objectID": "materials.html#morning-1",
    "href": "materials.html#morning-1",
    "title": "Course materials",
    "section": "Morning",
    "text": "Morning\n\nLecture 6: Introduction to causal inference, Erin Gabriel (pdf)\nExercise 3: Causal DAGs"
  },
  {
    "objectID": "materials.html#afternoon-1",
    "href": "materials.html#afternoon-1",
    "title": "Course materials",
    "section": "Afternoon",
    "text": "Afternoon\n\nLecture 7: Estimands for causal prediction, Nan van Geloven (pdf)\nExercise 4: Estimands for causal prediction, Nan van Geloven\n\nSolutions (docx)"
  },
  {
    "objectID": "materials.html#morning-2",
    "href": "materials.html#morning-2",
    "title": "Course materials",
    "section": "Morning",
    "text": "Morning\n\nLecture 8: Estimation, Karla Diaz-Ordaz (pdf)\nExercise 5: Estimation\n\nSolution"
  },
  {
    "objectID": "materials.html#afternoon-2",
    "href": "materials.html#afternoon-2",
    "title": "Course materials",
    "section": "Afternoon",
    "text": "Afternoon\n\nLecture 9: Evaluation, Nan van Geloven (pdf)\nExercise 6: Evaluation\n\nSolutions"
  },
  {
    "objectID": "materials.html#morning-3",
    "href": "materials.html#morning-3",
    "title": "Course materials",
    "section": "Morning",
    "text": "Morning\n\nLecture 10: Time to event outcomes and strategies, Ruth Keogh (pdf)\nLecture 11: Case study, Nan van Geloven (pdf)\nCase study assignment (docx)"
  },
  {
    "objectID": "materials.html#afternoon-3",
    "href": "materials.html#afternoon-3",
    "title": "Course materials",
    "section": "Afternoon",
    "text": "Afternoon"
  }
]